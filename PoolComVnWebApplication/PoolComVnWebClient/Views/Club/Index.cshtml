@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    Layout = "~/Views/Shared/_ClubLayout.cshtml";
}
@{
    string email = HttpContextAccessor.HttpContext.Request.Cookies["Email"];
}
@using PoolComVnWebClient.DTO
@model ClubDTO

@if (@ViewBag.Club == null)
{
    <div class="dashboard-container container">
        <div class="row news-items p-0 m-0">
            <div class="item-content d-flex justify-content-center">
                <h3>Bạn chưa có câu lạc bộ</h3>
                <a class="btn btn-primary ml-2" asp-action="CreateClub" asp-controller="Club">Thêm câu lạc bộ</a>
            </div>
        </div>
    </div>
}
else
{


    <div class="dashboard-container container">
        <div class="row news-items p-0 m-0">
            <div class="d-flex justify-content-end p-0 mb-5">
                <div class="tour-search d-flex justify-content-end align-items-center">
                    <i class="search-btn fa-solid fa-magnifying-glass"></i>
                    <input class="search-input px-2" type="text" placeholder="Giải đấu, địa chỉ,..." />
                </div>
            </div>
            @if (ViewBag.AccountEmail == email)
            {
                <div class="item-content d-flex justify-content-center">
                    <a asp-action="AddPost" asp-controller="Club" asp-route-clubid="@ViewBag.CLub.ClubId" class="create-btn d-flex justify-content-center align-items-center">
                        <div class="text-center">
                            <i class="fa-solid fa-plus fa-beat"></i>
                            <div>Tạo bài viết mới</div>
                        </div>
                    </a>
                </div>
            }
            @if (((List<ClubPostDTO>)ViewBag.ClubPost)?.Count != 0)
            {
                foreach (var post in ViewBag.ClubPost)
                {
                    <div class="item-content d-flex justify-content-center">
                        <a asp-action="ClubPostDetails" asp-controller="Club" asp-route-id="@post.PostId" asp-route-clubid="@post.ClubId" class="news-item">
                            <div class="news-date">@post.UpdatedDate.ToString("yyyy-MM-dd")</div>
                            @if (ViewBag.AccountEmail == email)
                            {
                                <div class="hidden-btn" data-post-id="@post.PostId">
                                    <i class="fa-solid fa-eye-slash"></i>
                                </div>
                            }
                            <div class="news-image">
                                <img src="@post.Flyer" alt="" />
                            </div>
                            <div class="news-title">@post.Title</div>
                        </a>
                    </div>
                }
            }
            else
            {
                <p>Câu lạc bộ chưa có bài đăng nào.</p>
            }


        </div>
    </div>

    <script>
        const hiddenBtns = document.querySelectorAll('.hidden-btn');

        hiddenBtns.forEach(hiddenBtn => {
            hiddenBtn.addEventListener('click', async (e) => {
                e.preventDefault();

                try {
                    const postId = hiddenBtn.dataset.postId;
                    const response = await fetch(`https://localhost:5000/api/ClubPost/ChangeStatus?id=${postId}`, {
                        method: 'Get',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    if (response.ok) {
                        if (hiddenBtn.querySelector('i').classList.contains('fa-eye-slash')) {
                            hiddenBtn.innerHTML = '<i class="fa-solid fa-eye"></i>';
                            var parent = hiddenBtn.parentNode;
                            var newsImage = parent.querySelector('.news-image');
                            newsImage.classList.add('hidden');
                        } else {
                            hiddenBtn.innerHTML = '<i class="fa-solid fa-eye-slash"></i>';
                            var parent = hiddenBtn.parentNode;
                            var newsImage = parent.querySelector('.news-image');
                            newsImage.classList.remove('hidden');
                        }
                    } else {

                        console.error('Lỗi khi gọi API:', response.statusText);
                    }
                } catch (error) {
                    console.error('Lỗi:', error);
                }
            });
        });

        //Handle active nav
        const clubNavBtn = document.querySelector('.club-post');
        clubNavBtn.classList.add('active');
    </script>
}