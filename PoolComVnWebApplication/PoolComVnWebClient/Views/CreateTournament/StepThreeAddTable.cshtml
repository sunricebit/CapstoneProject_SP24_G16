@using PoolComVnWebClient.DTO
@{
    Layout = "~/Views/Shared/_CreateTournamentLayout.cshtml";
}
@model List<TableDTO>

<div class="container-full">
    <div class="create-tour d-flex justify-content-end">
        <div class="tour-step-nav">
            <div class="tour-step">
                <div class="step-number">1</div>
                <div class="step-title">Cài đặt</div>
            </div>
            <div class="step-network-line"></div>
            <div class="tour-step">
                <div class="step-number">2</div>
                <div class="step-title">Người chơi</div>
            </div>
            <div class="step-network-line"></div>
            <div class="tour-step">
                <div class="step-number active">3</div>
                <div class="step-title">Bàn đấu</div>
            </div>
            <div class="step-network-line"></div>
            <div class="tour-step">
                <div class="step-number">4</div>
                <div class="step-title">Ảnh bìa</div>
            </div>
            <div class="step-network-line"></div>
            <div class="tour-step">
                <div class="step-number">5</div>
                <div class="step-title">Xếp trận</div>
            </div>
            <div class="step-network-line"></div>
            <div class="tour-step">
                <div class="step-number">6</div>
                <div class="step-title">Hoàn thành</div>
            </div>
        </div>
        <div class="create-tour-display col-lg-10">
            <div class="create-step-two">
                <div class="display-title d-flex justify-content-between">
                    <div>Danh sách bàn đấu</div>
                </div>
                <!-- Danh sách tất cả -->
                <div class="display-content">
                    <div class="d-flex justify-content-between">
                        <div>
                            <button class="club-player" disabled>Xóa khỏi giải đấu</button>
                            <!-- Forward to addTable page of club -->
                            <button class="club-player">Thêm bàn</button>
                        </div>
                        <div class="player-search d-flex align-items-end">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input class="" />
                        </div>
                    </div>

                    <div class="pt-3">
                        <div class="table-overflow">
                            <table class="players-table">
                                <tr>
                                    <th>
                                        <input class="all-checkbox" type="checkbox">
                                    </th>
                                    <th>#</th>
                                    <th>Nhãn</th>
                                    <th class="text-center">Ảnh</th>
                                    <th class="text-center">Kích thước</th>
                                    @*  <th>Hãng</th> *@
                                    <th>Tên bàn</th>
                                    <th>Hành động</th>
                                </tr>
                                @foreach (var table in Model)
                                {
                                    <tr>
                                        <td>
                                            <input class="one-checkbox" type="checkbox">
                                        </td>
                                        <td>1</td>
                                        <td>@table.TagName</td>
                                        <td class="d-flex justify-content-center">
                                            <img src="@table.Image" alt="" style="width: 100px; height: 100px;">
                                        </td>
                                        <td class="text-center">@table.Size</td>
                                        @*   <td>Rasson</td> *@
                                        <td>@table.TableName</td>
                                        <td>
                                            <a class="edit-button" href="#"><i class="fa-solid fa-pencil p-2"></i></a>
                                            <a href="#"><i class="fa-solid fa-trash-can p-2"></i></a>
                                        </td>
                                    </tr>
                                }
                            </table>
                        </div>
                    </div>

                    <div class="tour-input pt-5">
                        <button class="submit-btn" type="submit">Lưu và chuyển sang bước 4</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="player-edit d-flex justify-content-center align-items-center d-none">
    <div class="edit-form">
        <div class="edit-header d-flex justify-content-between">
            <div class="edit-title">Thông tin bàn</div>
            <div class="edit-close">
                <i class="fa-solid fa-xmark"></i>
            </div>
        </div>
        <div class="form-overflow">
            <div class="input-line">
                <div class="input-title">Tên bàn</div>
                <div>
                    <input type="text" value="Bàn 1">
                </div>
            </div>
            <div class="input-line">
                <div class="input-title">Bàn chú ý</div>
                <div>
                    <select>
                        <option value="Có">Có</option>
                        <option value="Không">Không</option>
                    </select>
                </div>
            </div>
            <div class="input-line d-flex justify-content-around">
                <button>Hủy</button>
                <button>Lưu</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal for adding a table -->
<div id="addTableModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Thêm bàn</h2>
        <label for="tableName">Tên bàn:</label>
        <input type="text" id="tableName" name="tableName" required>

        <label for="tag">Nhãn:</label>
        <input type="text" id="tag" name="tag" required>

        <label for="size">Kích thước:</label>
        <input type="text" id="size" name="size" required>

        <label for="image">Ảnh:</label>
        <input type="text" id="image" name="image" required>

        <label for="status">Status:</label>
        <input type="checkbox" id="status" name="status" checked>

        <label for="isScheduling">Is Scheduling:</label>
        <input type="checkbox" id="isScheduling" name="isScheduling">

        <label for="isUseInTour">Is Use In Tour:</label>
        <input type="checkbox" id="isUseInTour" name="isUseInTour">

        <button id="saveTable">Lưu</button>
    </div>
</div>
<style>
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }</style>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    //Handle entry checkbox
    const allCheckboxBtn = document.querySelector('.all-checkbox');
    const checkboxList = document.querySelectorAll('.one-checkbox');
    const addClubPlayer = document.querySelector('.club-player');
    const successBox = document.querySelector('.success-box');
    const rowList = document.querySelectorAll('.players-table tr');
    const containerFull = document.querySelector('.container-full');

    function AddTable() {
        $.ajax({
            url: "https://localhost:5000/api/Table/AddTable",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result, status) {
                console.log(result);
                ShowAllProducts(); // Refresh the table after adding a new table
            },
            error: function (xhr, status, error) {
                console.log(xhr);
            }
        });
    }

    $('.club-player').on('click', function () {
        $('#addTableModal').css('display', 'block');
    });

    $('.close').on('click', function () {
        $('#addTableModal').css('display', 'none');
    });

    $('#saveTable').on('click', function () {
        $.ajax({
            url: "https://localhost:5000/api/Table/AddTable",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                tableName: $('#tableName').val(),
                // ... (Other fields)
            }),
            success: function (result, status) {
                console.log(result);
                ShowAllProducts();
                $('#addTableModal').css('display', 'none');
                displaySuccessBox(); // Add this line to show success message
            },
            error: function (xhr, status, error) {
                console.log(xhr);
            }
        });
    });
    function displaySuccessBox() {
        const successBox = $('<div class="success-box">Thành công</div>').appendTo('.container-full');
        setTimeout(() => {
            successBox.css('right', '50px');
            setTimeout(() => {
                successBox.remove();
            }, 1500);
        }, 100);
    }
    allCheckboxBtn.addEventListener('change', () => {
        if (allCheckboxBtn.checked) {
            checkboxList.forEach(cb => {
                cb.checked = true;
                cb.classList.add('group');
            })
        } else {
            checkboxList.forEach(cb => {
                cb.checked = false;
                cb.classList.remove('group');
            })
        }
        setDisable();
    });

    checkboxList.forEach(cb => {
        cb.addEventListener('click', (e) => {
            e.stopPropagation();
            if (cb.checked === true) {
                cb.classList.add('group');
                addClubPlayer.disabled = false;
                const groupList = document.querySelectorAll('.one-checkbox.group');
                if (groupList.length === checkboxList.length) {
                    allCheckboxBtn.checked = true;
                }
            } else {
                cb.classList.remove('group');
                setDisable();
                const groupList = document.querySelectorAll('.one-checkbox.group');
                allCheckboxBtn.checked = false;
            }
        })
    });

    rowList.forEach(row => {
        row.addEventListener('click', () => {
            const cb = row.querySelector('.one-checkbox');
            if (cb !== null) {
                cb.checked = !cb.checked;
                if (cb.checked === true) {
                    cb.classList.add('group');
                    addClubPlayer.disabled = false;
                    const groupList = document.querySelectorAll('.one-checkbox.group');
                    if (groupList.length === checkboxList.length) {
                        allCheckboxBtn.checked = true;
                    }
                } else {
                    cb.classList.remove('group');
                    setDisable();
                    const groupList = document.querySelectorAll('.one-checkbox.group');
                    allCheckboxBtn.checked = false;
                }
            }
        })
    })

    function setDisable() {
        const groupList = document.querySelectorAll('.one-checkbox.group');
        if (groupList.length > 0) {
            addClubPlayer.disabled = false;
        } else {
            addClubPlayer.disabled = true;
        }
    }

    addClubPlayer.addEventListener('click', displaySuccessBox);

    function displaySuccessBox() {
        this.disabled = true;
        if (addClubPlayer.disabled === true) {
            const groupList = document.querySelectorAll('.one-checkbox.group');
            groupList.forEach(cb => {
                cb.checked = false;
                cb.classList.remove('group');
            });
            allCheckboxBtn.checked = false;
        }

        const successBox = document.createElement('div');
        successBox.className = 'success-box d-none';
        successBox.textContent = 'Thành công';
        containerFull.appendChild(successBox);

        successBox.classList.remove('d-none');
        setTimeout(() => {
            successBox.style.right = '50px';
            setTimeout(() => {
                successBox.remove();
            }, 1500);
        }, 100);
    }

    //close player-edit
    const closeBtn = document.querySelector('.edit-close');
    const playerEdit = document.querySelector('.player-edit');
    closeBtn.addEventListener('click', () => {
        playerEdit.classList.add('d-none');
    })

    //edit button
    const editBtns = document.querySelectorAll('.edit-button');
    editBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            playerEdit.classList.remove('d-none');
        })
    })
</script>